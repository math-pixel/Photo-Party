<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin</title>
    <link rel="stylesheet" href="styles/styleCommun.css">
    <link rel="stylesheet" href="styles/styleAdminPage.css">
    <link rel="icon" type="image/x-icon" href="/files/favicon.png">
</head>
<body>
    <!-- premiere page admin -->

    <form action="adminParameter" method="POST" class="formulaire">
        <input type="submit" id="inputSub" value="" class="buttonParameter"/>

        <svg width="25%" height="50" viewBox="0 0 190 84" fill="none" xmlns="http://www.w3.org/2000/svg" class="logo">
            <g clip-path="url(#clip0_52_27)">
            <path d="M90.78 43.45C92.39 43.45 93.91 43.29 95.35 42.97C95.41 42.97 104.52 41.61 111.85 31.71C116.4 25.58 112.3 28.56 108.51 31.73C109.01 30.46 109.39 29.12 109.64 27.73C111.4 17.76 106.98 10.26 98.25 8.49C100.04 5.43 100.21 3.09 95.72 3.88C87.88 5.26 82.16 11.27 79.51 14.64C78.92 15.34 78.39 16.08 77.9 16.86C77.86 16.92 77.84 16.96 77.84 16.96C76.61 18.99 75.74 21.29 75.3 23.79C73.28 35.13 79 43.43 90.79 43.43L90.78 43.45ZM93.64 17.13C98.8 17.13 100.65 21.34 99.81 26.11C98.86 31.33 96.22 34.47 91.39 34.47C86.17 34.47 84.15 30.88 85.22 24.99C85.62 22.71 86.64 20.6 88.27 19.14L89.61 18.93C89.61 18.93 90.13 18.41 90.93 17.58C91.75 17.3 92.65 17.14 93.64 17.14V17.13Z" fill="#0000B2"/>
            <path d="M96.9 76.21L94.01 76.55L91.37 71C95.19 69.77 97.71 67.13 98.55 62.25C99.9 54.45 95.52 49.57 86.88 49.57H78.56L77.78 44.91L71.83 49.57L67.21 75.72L62.16 76.16L57.02 49.56H49.85L51.01 44.9L45.06 49.56L26.6 83.23H37.43L43.38 78.57L43.45 78.06H52.36L53.15 83.22H63.53L66.26 81.11L65.89 83.22H75.99L81.94 78.56L80.37 75.25L77.27 76.13L78.02 71.94H81.22L85.43 83.22H97.16L103.11 78.56L101.37 76L96.92 76.19L96.9 76.21ZM44.76 70L45.27 67.96L46.41 65.74C47.48 63.66 48.49 61.59 49.5 59.57H49.67C49.89 61.59 50.23 63.67 50.51 65.74L51.13 70H44.77H44.76ZM88.61 61.75C88.33 63.32 87.15 64.11 84.63 64.11H79.35L80.36 58.55H85.47C87.83 58.55 89.01 59.45 88.61 61.75Z" fill="#0000B2"/>
            <path d="M163.87 44.92L157.92 49.58L149.39 62.54H149.28L145.35 49.58H144.95C145.13 48.83 145.26 48.23 145.26 48.23L140.52 44.92L134.57 49.58L134.51 49.69L135.14 51.4L131.29 52.24L131.76 49.58H112.42L111.89 47.09L109.87 44.93L103.92 49.59L102.24 59.13H111.11L106.84 83.26H116.94L122.89 78.6L120.57 75.54L118.37 75.19L121.21 59.13H130.08L136.03 54.47L135.81 53.22L142.82 72.37L140.91 83.26H151.01L156.96 78.6L152.57 74.35L152.93 72.31L169.2 49.69L169.26 49.58H166.37L163.87 44.92Z" fill="#0000B2"/>
            <path d="M21.76 74.11C22.37 73.94 22.95 73.73 23.5 73.5C26.83 72.19 33.45 68.86 36.39 62.23C38.68 57.08 35.13 59.15 31.64 61.88C32.18 54.56 27.43 49.57 18.52 49.57H13.99L11.89 44.91L5.94 49.57L0 83.25H10.1L16.05 78.59V74.88C18.04 74.87 19.86 74.62 21.5 74.18C21.5 74.18 21.59 74.17 21.76 74.12V74.11ZM21.11 62.65C20.66 65.12 18.98 65.9 16.17 65.9H16.06V58.55H17.41C20.33 58.55 21.56 60.23 21.11 62.65Z" fill="#0000B2"/>
            <path d="M22.93 37.95L19.4 34.9L18.39 34.54L18.44 34.24H22.76C25.28 34.24 27.52 33.87 29.47 33.19V33.21C29.47 33.21 29.63 33.15 29.93 33.04C30 33.01 30.06 32.99 30.13 32.96C31.95 32.24 37.08 29.95 40.64 25.88L37.69 42.6H47.79L53.74 37.94L49.32 33.87L49.92 30.42H61.14L59.01 42.6H69.11L75.06 37.94L71.11 31.32L75.07 8.92002H73.35L73.59 5.84002L70.91 4.27002L64.96 8.93002L62.83 20.88H51.61L53.74 8.93002H52.37C52.37 8.83002 52.37 8.76002 52.37 8.76002L49.59 4.27002L43.64 8.93002L41.97 18.36C40.92 18.5 39.61 19.04 38.55 19.56C38.29 13.17 33.61 8.93002 25.4 8.93002H22.2C22.13 8.32002 22.06 7.89002 22.03 7.85002C21.91 7.68002 18.78 4.28002 18.78 4.28002L12.83 8.94002L6.88 42.61H16.98L22.93 37.95ZM27.98 22.01C27.53 24.48 25.85 25.26 23.04 25.26H20.07L21.36 17.91H24.28C27.2 17.91 28.43 19.59 27.98 22.01Z" fill="#0000B2"/>
            <path d="M173.59 29.79C173.78 29.12 173.94 28.44 174.07 27.73C175.99 16.85 170.56 8.92002 160.2 8.16002C162.25 5.29002 162.81 3.29002 159.58 4.02002C154.79 5.10002 150.21 8.68002 146.96 11.8C146.42 12.2 145.91 12.62 145.42 13.08L143.84 9.60002H141.39L141.51 8.94002H123.88L119.62 4.28002L113.67 8.94002L111.99 18.48H120.86L116.59 42.61H126.69L132.64 37.95L128.27 33.69L130.96 18.48H139.83L142.79 16.15C142.61 16.41 142.45 16.67 142.28 16.94L142.27 16.96C141.04 19 140.16 21.3 139.72 23.81C137.7 35.15 143.42 43.45 155.21 43.45C157 43.45 158.69 43.24 160.27 42.86C160.27 42.86 168.99 41.09 175.85 32.26C179.48 27.59 176.86 28.19 173.59 29.8V29.79ZM149.65 24.98C150.38 20.77 153.24 17.12 158.07 17.12C163.23 17.12 165.08 21.33 164.24 26.1C163.29 31.32 160.65 34.46 155.82 34.46C150.6 34.46 148.58 30.87 149.65 24.98Z" fill="#0000B2"/>
            <path d="M181.78 11.2C181.97 11.08 182.15 10.94 182.32 10.78L188.22 6.17L185 2.23L183.8 0.630005L178.08 5.14C177.04 5.76 176.33 6.89 176.33 8.2C176.33 10.16 177.92 11.75 179.88 11.75C180.58 11.75 181.23 11.54 181.78 11.19V11.2Z" fill="#0000B2"/>
            <path d="M24.39 29.59L22.93 37.95H12.83L18.78 4.28H31.35C40.95 4.28 45.72 10.06 44.26 18.31C43.08 25.16 37.53 29.59 28.72 29.59H24.4H24.39ZM27.31 13.26L26.02 20.61H28.99C31.8 20.61 33.48 19.82 33.93 17.36C34.38 14.95 33.14 13.26 30.23 13.26H27.31Z" fill="white"/>
            <path d="M64.96 37.95L67.09 25.77H55.87L53.74 37.95H43.64L49.59 4.28H59.69L57.56 16.23H68.78L70.91 4.28H81.01L75.06 37.95H64.96Z" fill="white"/>
            <path d="M81.24 19.15C82.87 9.95 90.27 3.44 100.04 3.44C111.49 3.44 117.6 11.63 115.58 23.08C113.95 32.17 106.94 38.79 96.72 38.79C84.94 38.79 79.21 30.48 81.23 19.15H81.24ZM105.76 21.45C106.6 16.68 104.75 12.47 99.59 12.47C94.76 12.47 91.9 16.12 91.17 20.33C90.1 26.22 92.12 29.81 97.34 29.81C102.17 29.81 104.8 26.67 105.76 21.45Z" fill="white"/>
            <path d="M119.63 4.28H147.46L145.78 13.82H136.91L132.65 37.95H122.55L126.82 13.82H117.95L119.63 4.28Z" fill="white"/>
            <path d="M145.67 19.15C147.3 9.95 154.7 3.44 164.47 3.44C175.92 3.44 182.03 11.63 180.01 23.08C178.38 32.17 171.37 38.79 161.15 38.79C149.37 38.79 143.64 30.48 145.66 19.15H145.67ZM170.19 21.45C171.03 16.68 169.18 12.47 164.02 12.47C159.19 12.47 156.33 16.12 155.6 20.33C154.53 26.22 156.55 29.81 161.77 29.81C166.6 29.81 169.23 26.67 170.19 21.45Z" fill="white"/>
            <path d="M17.51 70.23L16.05 78.59H5.95L11.9 44.92H24.47C34.07 44.92 38.84 50.7 37.38 58.95C36.2 65.8 30.65 70.23 21.84 70.23H17.52H17.51ZM20.43 53.9L19.14 61.25H22.11C24.92 61.25 26.6 60.46 27.05 58C27.5 55.59 26.26 53.9 23.35 53.9H20.43Z" fill="white"/>
            <path d="M58.31 73.43H46.02L43.38 78.59H32.55L51.01 44.92H62.96L69.47 78.59H59.09L58.3 73.43H58.31ZM50.17 65.35H57.07L56.45 61.09C56.17 59.01 55.83 56.94 55.61 54.92H55.44C54.43 56.94 53.42 59.02 52.35 61.09L50.16 65.35H50.17Z" fill="white"/>
            <path d="M87.15 67.31H83.95L81.93 78.59H71.83L77.78 44.92H92.82C101.46 44.92 105.84 49.8 104.49 57.6C103.65 62.48 101.12 65.12 97.31 66.35L103.09 78.47V78.58H91.36L87.15 67.3V67.31ZM86.31 53.9L85.3 59.46H90.58C93.1 59.46 94.28 58.67 94.56 57.1C94.95 54.8 93.77 53.9 91.42 53.9H86.31Z" fill="white"/>
            <path d="M109.88 44.92H137.71L136.03 54.46H127.16L122.9 78.59H112.8L117.07 54.46H108.2L109.88 44.92Z" fill="white"/>
            <path d="M146.87 78.59L148.78 67.7L140.47 45.03L140.53 44.92H151.3L155.23 57.88H155.34L163.87 44.92H175.21L175.15 45.03L158.88 67.65L156.97 78.59H146.87Z" fill="white"/>
            <path d="M185.82 7.1C187.781 7.1 189.37 5.51061 189.37 3.55C189.37 1.58939 187.781 0 185.82 0C183.859 0 182.27 1.58939 182.27 3.55C182.27 5.51061 183.859 7.1 185.82 7.1Z" fill="white"/>
            </g>
            <defs>
            <clipPath id="clip0_52_27">
            <rect width="189.37" height="83.25" fill="white"/>
            </clipPath>
            </defs>
            </svg>
    </form>

    
    <div class="mainPageContainer">
        
        <div class="containerElement">
            

            <div id="parentContainerImage" class="parentContainerImage" >
            </div>
        
            <div id="parentContainerimageWaiting" class="parentContainerimageWaiting">
                <p class="waitingText">En attente ...</p>
            </div>
        
        </div>

    </div>

    

</body>



<script>

    // redimensionner la page
    const windowInnerWidth  = window.innerWidth;
    const windowInnerHeight = window.innerHeight;
    document.body.style.width = windowInnerWidth + "px"
    document.body.style.height = windowInnerHeight + "px"

    const urlServer = "localhost"
    const portHttp = ":5000"
    const portws = ":8080"

    const ws = new WebSocket(`ws://${urlServer + portws}`);

    ws.addEventListener("open", () =>{
        console.log("We are connected");
        ws.send(JSON.stringify({requestImage : true}))
    });
        
    ws.addEventListener('message', function (event) {

        data = JSON.parse(event.data)

        if(data.adminPanel){
            
            if (data.adminPanel.setUpImages) {
                addImage(data.adminPanel.setUpImages)
            }

        }
  
    });


    //* ########## append image ##########
    let parentSupreme;
    let parentNoWaiting = document.querySelector("#parentContainerImage")
    let parentWaiting = document.querySelector("#parentContainerimageWaiting")

    function addImage(imageArray){


        
        let checked = ""
        // console.log(imageArray.length)
        imageArray.forEach(element => {


            checked = ""
            if (element.is_allowed == 1) {
                // console.log("checked")
                checked = "checked"
            }


            let choiceValidationHtmlBalise;
            // * choix de la categories si il est en attente ou pas
            // * Creation des elements "type"
            if (element.is_waiting == 0) {
                parentSupreme = parentNoWaiting
                choiceValidationHtmlBalise = `<div class="container-checkbox"><label class="control control-checkbox"><input type="checkbox" class="isAllow" onclick="getAllowValue(this)" ${checked}><div class="control_indicator"></div></label></div>`;
            }else{
                parentSupreme =parentWaiting
                choiceValidationHtmlBalise = `<div class="containerYesNo"><button onclick="setUpItem(this, true)">Oui</button><button onclick="setUpItem(this, false)">Non</button></div>`
            }

            // * insertion dans la partie en attente ou normal
            if (element.media.includes("mp4")) {
                // include video media readeer
    
                parentSupreme.innerHTML += `<div class="parentContainer"><video autoplay loop muted class="imageView"><source src="${'http://' + urlServer + portHttp + element.media}" ></video><input type="text" class="idImageRow" value="${element.photo_id}"><div class='flexBoxCommentaire'><label for="" class="commentaire">${element.commentary}</label>${choiceValidationHtmlBalise}</div></div>`
            }else{
                // affiche un imageé
                parentSupreme.innerHTML += `<div class="parentContainer"><img src="${'http://' + urlServer + portHttp + element.media}" alt="" class="imageView"><input type="text" class="idImageRow" value="${element.photo_id}"><div class='flexBoxCommentaire'><label for="" class="commentaire">${element.commentary}</label>${choiceValidationHtmlBalise}</div></div>`
            }
        });


        doShowPanelWaiting()

    }

    function getAllowValue(htmlobject){

        let idRowSQL = htmlobject.parentNode.parentNode.parentNode.parentNode.children[1].value
        let valueCheckbox = htmlobject.checked

        changeAllowValue(idRowSQL, valueCheckbox)

    }

    function setUpItem(htmlobject, ChoiceValue){

        let idRowSQL =  htmlobject.parentNode.parentNode.parentNode.children[1].value
        // console.log(htmlobject.parentNode.parentNode.parentNode.children[1].value)
        // set up value checkbox
        changeAllowValue(idRowSQL, ChoiceValue)

        // remove this item from waiting list
        removeFromWaitingList(idRowSQL)

        // set visual in div with other no waiting 
        let htmlObjectContainer = htmlobject.parentNode.parentNode.parentNode
        alternateChildren(htmlObjectContainer, ChoiceValue)
    }

    function changeAllowValue(idRowSQL, valueCheckbox){
        // console.log(htmlobject.parentNode.children[3].checked)

        ws.send(JSON.stringify({ changeAllowValue : { idRow : idRowSQL, value : valueCheckbox } }))
        
    }

    function removeFromWaitingList(idRowSQL){
        ws.send(JSON.stringify({ removeFromWaitingList : { idRow : idRowSQL } }))
    }

    function alternateChildren(htmlObject, ChoiceValue){
        console.log(htmlObject)

        // remove choice div
        // console.log(htmlObject.children[3])

        let checked = ""
        if (ChoiceValue == true) {
            checked = "checked"
        }

        // save global "card" data
        let newObject = htmlObject

        // remove container yes no
        htmlObject.childNodes[2].removeChild(htmlObject.childNodes[2].childNodes[1])
        newObject.children[2].innerHTML += `
                <div class="container-checkbox">
                        <label class="control control-checkbox">
                            <input type="checkbox" class="isAllow" onclick="getAllowValue(this)"  ${checked}/>
                            <div class="control_indicator"></div>
                        </label>
                    </div>
                `;

        parentNoWaiting.appendChild(newObject)


        doShowPanelWaiting()
    }

    function doShowPanelWaiting(){

        if (parentWaiting.children.length > 1) {
            // panel deplier
            parentWaiting.style.width = "30%"
            // set up 5 element 
            parentNoWaiting.style.gridTemplateColumns = "repeat(5, 1fr)"
            // grid-template-columns: repeat(6, 1fr);
        }else{
            // panel pas deplier
            parentWaiting.style.width = "0%"
            // set up 6 element
            parentNoWaiting.style.gridTemplateColumns = "repeat(6, 1fr)"
        }
    }

    
</script>

<style>


    .idImageRow{
        width: 0;
        height: 0;
        opacity: 0;
    }
</style>

</html>